// Generated by CoffeeScript 1.10.0
(function() {
  var cancel, setAlarm;

  setAlarm = function(notification) {
    var alarm;
    alarm = function(data) {
      var note;
      butterfly.body.classList.remove('alarm');
      note = "New activity on butterfly terminal [" + butterfly.title + "]";
      if (notification) {
        new Notification(note, {
          body: data.data,
          icon: '/static/images/favicon.png'
        });
      } else {
        alert(note + '\n' + data.data);
      }
      return butterfly.ws.removeEventListener('message', alarm);
    };
    butterfly.ws.addEventListener('message', alarm);
    return butterfly.body.classList.add('alarm');
  };

  cancel = function(ev) {
    if (ev.preventDefault) {
      ev.preventDefault();
    }
    if (ev.stopPropagation) {
      ev.stopPropagation();
    }
    ev.cancelBubble = true;
    return false;
  };

  document.addEventListener('keydown', function(e) {
    if (!(e.altKey && e.keyCode === 65)) {
      return true;
    }
    if (Notification && Notification.permission === 'default') {
      Notification.requestPermission(function() {
        return setAlarm(Notification.permission === 'granted');
      });
    } else {
      setAlarm(Notification.permission === 'granted');
    }
    return cancel(e);
  });

}).call(this);
